<html>
    <head>
        <!-- Constatnts and Globals. MUST be first -->
        <!--<script src="{{ url_for ('static', filename='js/const.js') }}" charset="utf-8"></script>
            <script src="{{ url_for ('static', filename='js/local_tags.js') }}" charset="utf-8"></script>
            <script src="{{ url_for ('static', filename='js/bumps_gui.js') }}" charset="utf-8"></script>
        <script src="{{ url_for ('static', filename='js/random_words.js') }}" charset="utf-8"></script>-->

        <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="{{ url_for ('static', filename='js/celery_setup.js') }}" charset="utf-8"></script>
        <link rel="stylesheet" href="{{ url_for ('static', filename='css/bumps_gui.css') }}"/>
        <!--<link rel="stylesheet" href="{{ url_for ('static', filename='css/bumps_portal.css') }}"/>-->
        <script>
            function onBrokerTestClick() {
                var jsnParams = getServersParams();
                var text = JSON.stringify(jsnParams);
                $.ajax({
                    url: "/test_broker",
                    type: "get",
                    data: {jsdata: text},
                    success: function(response) {
                        try {
                            jsonResponse = JSON.parse(response.replace(/\'/g,'"'));
                            if (jsonResponse.result) {
                                document.getElementById('broker_test_result').innerText = 'OK';
                                document.getElementById('broker_test_message').innerText = jsonResponse.message;
                            }
                            else {
                                document.getElementById('broker_test_result').innerText = 'Fail';
                                document.getElementById('broker_test_message').innerText = jsonResponse.message;
                            }
                            console.log(jsonResponse.toString());
                        }
                        catch (e) {
                            var err_msg = 'response ' + respones + 'can not be handled' + '\n' + e.message;
                            alert (err_msg);
                        }
                        //document.getElementById('celery_test_result').innerText = response;
                        //$("#place_for_suggestions").html(response);
                    },
                    error: function(xhr) {
                        //str = f'runtimer error: {xhr}'
                        console.log('runtime error: ' + xhr);
                    }
                });
            }
        </script>
    </head>
            <title>Bumps Celery Setup</title>
    <!--<body onload="init_app()">-->
    <body>
        <h3 style="text-align: center;">Bumps Celery Setup</h3>
        <p>Python Parameter: {{ dir }}</p>
        <table>
            <tr>
                <th>Function</th>
                <th>Broker</th>
                <th>Backend</th>
            </tr>
            <tr>
                <th>Server Type</th>
                <td>
                    <select id="broker_type">
                        <option value="rabbit">RabbitMQ</option>
                        <option value="redis">Redis</option>
                    </select>
                </td>
                <td>
                    <select id="backend_type">
                        <option value="rabbit">RabbitMQ</option>
                        <option value="redis">Redis</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th>Server Type</th>
                <td><input type="text" id="txtBroker" value="rabbit-server"></td>
                <td><input type="text" id="txtBackend" value="redis-server"></td>
            </tr>
            <tr>
                <th>Connection String</th>
                <td><input type="text" id="txtBrokerConnection" value="amqp://rabbit-server"></td>
                <td><input type="text" id="txtBkendConnection" value="redis://redis-server"></td>
            </tr>
            <tr>
                <th>Test</th>
                <!--<td><input type="button" id="btnCeleryTest" onclick="onCeleryTestClick()" value="Test Connection"></td>-->
                <td><input type="button" id="btnBrokerTest" onclick="onBrokerTestClick()" value="Test Broker"></td>
                <td>Backend Test</td>
            </tr>
            <tr>
                <th>Results</th>
                <td><div class="celery_result" id="broker_test_result">Broker Results</div></td>
                <td><div class="celery_class" id="backend_test_result">Broker Message</div></td>
            </tr>
            <tr>
                <th>Test Messages</th>
                <td><div id="broker_test_message">Backend Results</div></td>
                <!--style="text-align: center;"-->
                <td><div id="backend_test_message">Backend Message</div></td>
            </tr>
        </table>
        <div class="myclass">This is my class</div>
        <table>
            <tr>
                <td class="myclass">Cell #1</td>
                <td>Cell #2</td>
            </tr>
        </table>
    </body>
</html>
